/*!
 * Compressor.js v1.2.0
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-02-25T11:35:56.625Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Compressor=t()}(this,function(){"use strict";function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i,r=arguments[t];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var e,t,a,l,h,c,d,o,i={exports:{}},L=(e=i,"undefined"!=typeof window&&(a=(t=window).HTMLCanvasElement&&t.HTMLCanvasElement.prototype,l=t.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),h=l&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),c=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,d=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,o=(l||c)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(e){var t,i,r,a,o,n=e.match(d);if(!n)throw new Error("invalid data URI");for(t=n[2]?n[1]:"text/plain"+(n[3]||";charset=US-ASCII"),o=!!n[4],e=e.slice(n[0].length),i=(o?atob:decodeURIComponent)(e),n=new ArrayBuffer(i.length),r=new Uint8Array(n),a=0;a<i.length;a+=1)r[a]=i.charCodeAt(a);return l?new Blob([h?r:n],{type:t}):((o=new c).append(n),o.getBlob(t))},t.HTMLCanvasElement&&!a.toBlob&&(a.mozGetAsFile?a.toBlob=function(e,t,i){var r=this;setTimeout(function(){i&&a.toDataURL&&o?e(o(r.toDataURL(t,i))):e(r.mozGetAsFile("blob",t))})}:a.toDataURL&&o&&(a.msToBlob?a.toBlob=function(e,t,i){var r=this;setTimeout(function(){(t&&"image/png"!==t||i)&&a.toDataURL&&o?e(o(r.toDataURL(t,i))):e(r.msToBlob(t))})}:a.toBlob=function(e,t,i){var r=this;setTimeout(function(){e(o(r.toDataURL(t,i)))})})),e.exports?e.exports=o:t.dataURLtoBlob=o),i.exports),r={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null};const n="undefined"!=typeof window&&void 0!==window.document?window:{},j=e=>0<e&&e<1/0,f=Array.prototype["slice"];function D(e){return Array.from?Array.from(e):f.call(e)}const u=/^image\/.+$/;function k(e){return u.test(e)}const m=String["fromCharCode"];const g=n["btoa"];function z(e,t){var i=[];let r=new Uint8Array(e);for(;0<r.length;)i.push(m.apply(null,D(r.subarray(0,8192)))),r=r.subarray(8192);return`data:${t};base64,`+g(i.join(""))}function b(e){var a,o,n,s,l=new DataView(e);let h;try{let t,i,r;if(255===l.getUint8(0)&&216===l.getUint8(1)){var c=l.byteLength;let e=2;for(;e+1<c;){if(255===l.getUint8(e)&&225===l.getUint8(e+1)){i=e;break}e+=1}}if(r=i&&(a=i+4,o=i+10,"Exif"===function(e,t,i){let r="",a;for(i+=t,a=t;a<i;a+=1)r+=m(e.getUint8(a));return r}(l,a,4))&&(n=l.getUint16(o),(t=18761===n)||19789===n)&&42===l.getUint16(o+2,t)&&8<=(s=l.getUint32(o+4,t))?o+s:r){var d,f=l.getUint16(r,t);let e;for(e=0;e<f;e+=1)if(d=r+12*e+2,274===l.getUint16(d,t)){d+=8,h=l.getUint16(d,t),l.setUint16(d,1,t);break}}}catch(e){h=1}return h}const p=/\.\d*(?:0|9){12}\d*$/;function H(e,t){t=1<arguments.length&&void 0!==t?t:1e11;return p.test(e)?Math.round(e*t)/t:e}function O(e,t){let{aspectRatio:i,height:r,width:a}=e;var o,e=1<arguments.length&&void 0!==t?t:"none",t=j(a),n=j(r);return t&&n?(o=r*i,("contain"===e||"none"===e)&&o>a||"cover"===e&&o<a?r=a/i:a=r*i):t?r=a/i:n&&(a=r*i),{width:a,height:r}}const{ArrayBuffer:w,FileReader:C}=n,y=n.URL||n.webkitURL,v=/\.\w+$/,B=n.Compressor;return class U{constructor(e,t){this.file=e,this.exif=[],this.image=new Image,this.options={...r,...t},this.aborted=!1,this.result=null,this.init()}init(){const{file:r,options:e}=this;if(t=r,"undefined"!=typeof Blob&&(t instanceof Blob||"[object Blob]"===Object.prototype.toString.call(t))){const a=r.type;if(k(a))if(y&&C){w||(e.checkOrientation=!1,e.retainExif=!1);var t="image/jpeg"===a;const o=t&&e.checkOrientation,n=t&&e.retainExif;!y||o||n?(t=new C,(this.reader=t).onload=e=>{var e=(e=e.target).result,t={};let i=1;o&&1<(i=b(e))&&s(t,function(e){let t=0,i=1,r=1;switch(e){case 2:i=-1;break;case 3:t=-180;break;case 4:r=-1;break;case 5:t=90,r=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90}return{rotate:t,scaleX:i,scaleY:r}}(i)),n&&(this.exif=function(e){var t=D(new Uint8Array(e)),i=t.length,r=[];let a=0;for(;a+3<i;){var o=t[a],n=t[a+1];if(255===o&&218===n)break;255===o&&216===n?a+=2:(o=256*t[a+2]+t[a+3],n=a+o+2,o=t.slice(a,n),r.push(o),a=n)}return r.reduce((e,t)=>255===t[0]&&225===t[1]?e.concat(t):e,[])}(e)),o||n?!y||1<i?t.url=z(e,a):t.url=y.createObjectURL(r):t.url=e,this.load(t)},t.onabort=()=>{this.fail(new Error("Aborted to read the image with FileReader."))},t.onerror=()=>{this.fail(new Error("Failed to read the image with FileReader."))},t.onloadend=()=>{this.reader=null},o||n?t.readAsArrayBuffer(r):t.readAsDataURL(r)):this.load({url:y.createObjectURL(r)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}load(e){const{file:t,image:i}=this;i.onload=()=>{this.draw({...e,naturalWidth:i.naturalWidth,naturalHeight:i.naturalHeight})},i.onabort=()=>{this.fail(new Error("Aborted to load the image."))},i.onerror=()=>{this.fail(new Error("Failed to load the image."))},n.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(n.navigator.userAgent)&&(i.crossOrigin="anonymous"),i.alt=t.name,i.src=e.url}draw(e){let{naturalWidth:a,naturalHeight:o,rotate:t=0,scaleX:i=1,scaleY:r=1}=e;const{file:n,image:s,options:l}=this;var h=(e=document.createElement("canvas")).getContext("2d"),c=Math.abs(t)%180==90,d=("contain"===l.resize||"cover"===l.resize)&&j(l.width)&&j(l.height);let f=Math.max(l.maxWidth,0)||1/0,u=Math.max(l.maxHeight,0)||1/0,m=Math.max(l.minWidth,0)||0,g=Math.max(l.minHeight,0)||0,b=a/o,{width:p,height:w}=l;c&&([f,u]=[u,f],[m,g]=[g,m],[p,w]=[w,p]),d&&(b=p/w),{width:f,height:u}=O({aspectRatio:b,width:f,height:u},"contain"),{width:m,height:g}=O({aspectRatio:b,width:m,height:g},"cover"),d?{width:p,height:w}=O({aspectRatio:b,width:p,height:w},l.resize):{width:p=a,height:w=o}=O({aspectRatio:b,width:p,height:w}),p=Math.floor(H(Math.min(Math.max(p,m),f))),w=Math.floor(H(Math.min(Math.max(w,g),u)));var y,v,B,U=-p/2,x=-w/2,A=p,R=w,T=[];d&&(y=d=0,v=a,B=o,{width:v,height:B}=O({aspectRatio:b,width:a,height:o},{contain:"cover",cover:"contain"}[l.resize]),d=(a-v)/2,y=(o-B)/2,T.push(d,y,v,B)),T.push(U,x,A,R),c&&([p,w]=[w,p]),e.width=p,e.height=w,k(l.mimeType)||(l.mimeType=n.type);let E="transparent";n.size>l.convertSize&&0<=l.convertTypes.indexOf(l.mimeType)&&(l.mimeType="image/jpeg");const M="image/jpeg"===l.mimeType;M&&(E="#fff"),h.fillStyle=E,h.fillRect(0,0,p,w),l.beforeDraw&&l.beforeDraw.call(this,h,e),this.aborted||(h.save(),h.translate(p/2,w/2),h.rotate(t*Math.PI/180),h.scale(i,r),h.drawImage(s,...T),h.restore(),l.drew&&l.drew.call(this,h,e),this.aborted)||(d=e=>{if(!this.aborted){const r=e=>this.done({naturalWidth:a,naturalHeight:o,result:e});if(e&&M&&l.retainExif&&this.exif&&0<this.exif.length){const i=e=>{return r(L(z((t=this.exif,255!==(i=D(new Uint8Array(e)))[2]||224!==i[3]?e:(e=256*i[4]+i[5],t=[255,216].concat(t,i.slice(4+e)),new Uint8Array(t))),l.mimeType)));var t,i};var t;e.arrayBuffer?e.arrayBuffer().then(i).catch(()=>{this.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))}):(t=new C,(this.reader=t).onload=e=>{e=e.target,i(e.result)},t.onabort=()=>{this.fail(new Error("Aborted to read the compressed image with FileReader."))},t.onerror=()=>{this.fail(new Error("Failed to read the compressed image with FileReader."))},t.onloadend=()=>{this.reader=null},t.readAsArrayBuffer(e))}else r(e)}},e.toBlob?e.toBlob(d,l.mimeType,l.quality):d(L(e.toDataURL(l.mimeType,l.quality))))}done(e){let{naturalWidth:t,naturalHeight:i,result:r}=e;var{file:e,image:a,options:o}=this;y&&0===a.src.indexOf("blob:")&&y.revokeObjectURL(a.src),!r||o.strict&&!o.retainExif&&r.size>e.size&&o.mimeType===e.type&&!(o.width>t||o.height>i||o.minWidth>t||o.minHeight>i||o.maxWidth<t||o.maxHeight<i)?r=e:(a=new Date,r.lastModified=a.getTime(),r.lastModifiedDate=a,r.name=e.name,r.name&&r.type!==e.type&&(r.name=r.name.replace(v,function(e){let t=k(e)?e.substr(6):"";return"."+(t="jpeg"===t?"jpg":t)}(r.type)))),this.result=r,o.success&&o.success.call(this,r)}fail(e){var t=this.options;if(!t.error)throw e;t.error.call(this,e)}abort(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}static noConflict(){return window.Compressor=B,U}static setDefaults(e){s(r,e)}}});